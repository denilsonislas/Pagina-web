<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de Valores de HTML</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #resultados {
            margin-top: 20px;
        }
        label, input, select, button, textarea {
            display: block;
            margin: 10px 0;
        }
        .resultado-item {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>

<h1>Extractor de Valores de HTML</h1>

<label>Ingrese información del repositorio:</label>
<textarea id="info_repos" rows="5" cols="50"></textarea>
<button onclick="procesarRamas()">Procesar Branches</button>

<label for="combo_ramas">Seleccione una rama:</label>
<select id="combo_ramas" onchange="onComboboxSelect()"></select>

<div id="resultados"></div>

<input type="file" id="fileInput" accept=".html" style="margin-top: 20px;">
<button onclick="seleccionarArchivo()">Seleccionar Archivo HTML</button>

<script>
    let ramasProcesadas = [];

    function seleccionarArchivo() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const contenido = e.target.result;
                obtenerValores(contenido);
            };
            reader.readAsText(file, 'UTF-8');
        }
    }

    function obtenerValores(html) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const correoQA = "denilson.islas@hey.inc";
        const telefonoQA = "0000000000";
        let numeroCambio = doc.querySelector('meta[name="ajs-issue-key"]')?.getAttribute('content') || '';
        let celularSolicitante = doc.querySelector("label:contains('Celular del solicitante:')")?.nextElementSibling?.textContent.trim() || '';
        let celularArquitecto = doc.querySelector("label:contains('Celular del arquitecto de negocio:')")?.nextElementSibling?.textContent.trim() || '';
        let celula = doc.querySelector('#customfield_11309-val')?.textContent.trim().replace(/ /g, "_") || '';

        mostrarValores([
            correoQA, celula, '', '', numeroCambio, celularSolicitante, celularArquitecto, telefonoQA, '', '', ''
        ]);
    }

    function mostrarValores(valores) {
        const resultadosDiv = document.getElementById('resultados');
        resultadosDiv.innerHTML = '';

        const etiquetas = [
            "Correo electronico QA:", "Celula:", "Branch:", "Correo del desarrollador:", 
            "Número de Cambio:", "Celular del solicitante:", "Celular del arquitecto de negocio:", 
            "Telefono de QA:", "MS:", "Repositorio:", "Informacion extra:"
        ];

        valores.forEach((valor, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.classList.add('resultado-item');

            const label = document.createElement('label');
            label.textContent = etiquetas[index];
            itemDiv.appendChild(label);

            const input = document.createElement('input');
            input.type = 'text';
            input.value = valor;
            itemDiv.appendChild(input);

            const copyButton = document.createElement('button');
            copyButton.textContent = "Copiar";
            copyButton.onclick = () => navigator.clipboard.writeText(valor);
            itemDiv.appendChild(copyButton);

            resultadosDiv.appendChild(itemDiv);
        });
    }

    function procesarRamas() {
        const infoRepos = document.getElementById('info_repos').value.trim();
        ramasProcesadas = [];
        
        const lineas = infoRepos.split('\n').map(linea => linea.trim()).filter(linea => linea);
        if (lineas.length > 1) lineas.shift(); // Omitir la primera línea si es el nombre del repositorio

        let repositorioActual = null;
        lineas.forEach(linea => {
            if (!/\d/.test(linea)) {
                repositorioActual = linea.trim();
            } else if (repositorioActual && linea.startsWith('release')) {
                const rama = linea.split(' ')[0].trim();
                ramasProcesadas.push({ repo: repositorioActual, rama });
            }
        });

        actualizarCombobox();
    }

    function actualizarCombobox() {
        const combo = document.getElementById('combo_ramas');
        combo.innerHTML = ''; // Limpiar opciones previas
        ramasProcesadas.forEach(({ repo, rama }) => {
            const option = document.createElement('option');
            option.value = `${repo} ${rama}`;
            option.textContent = `${repo} ${rama}`;
            combo.appendChild(option);
        });
    }

    function onComboboxSelect() {
        const seleccion = document.getElementById('combo_ramas').value;
        if (seleccion) {
            const [repo, rama] = seleccion.split(' ');
            document.querySelector("input[name='ms']").value = repo;
            document.querySelector("input[name='branch']").value = rama;
        }
    }
</script>

</body>
</html>
